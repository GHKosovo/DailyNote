[TOC]

## 什么时异常？

程序执行过程中的不正常情况

## 异常的作用

增强程序的健壮性

## Java中异常以什么形式存在？

异常在Java中以类的形式存在，每一个异常类都可以创建异常对象。

在程序中，通常是JVM来负责异常处理，当发生异常时，新建异常对象并抛出，打印输出信息岛控制台。

## Java的异常处理机制

异常在Java中以类和对象的形式存在。那么异常的继承结构是怎样的呢？可以用UML图来描述以下继承结构。详见  [## 课外课堂.md](## 课外课堂.md) 

## 异常的分类

`Throwable`是所有异常的父类，而`Throwable`本身继承自`Object`类，可抛出。

`Throwable`又有两个子类：`Error`（不可处理，直接退出JVM）和`Exception`（可处理）。

Exception底下又有两个子类：

- Exception的直接子类：编译时异常（要求程序员在编写程序极端必须预先对这个异常进行处理，如果不处理，编译器报错）；又叫受检异常（checkedException）和受控异常（）。
- RuntimeException：运行时异常（在编译程序阶段程序员可以预先处理，也可以不管，都行）；又叫未受检异常（UncheckedException）和非受控异常。

注意:warning:：编译时异常和运行时异常，都是发生在运行阶段。编译阶段异常是不会发生的，因为编译时异常必须在编译（编写）阶段预先处理，如果不处理，编译器报错，它也是因此而得名。所有异常都是在运行阶段发生的，因为只有程序运行阶段才可以new对象，而异常的发生其实就是new异常对象。

## 处理异常的方式

1. 在方法声明的位置上，使用`throw`关键字，抛给上一级。
2. 使用`try...catch`语句进行异常的捕获

注意1：如果Java中异常发生之后一直上抛，最终抛给了main方法，main方法最终会抛给调用者JVM，JVM接收到异常只有一种结果，终止程序的运行。

注意2：

- 只要异常没有捕获，采用上报的方式，此方法的后续代码不会执行。
- try语句中的某一行出现异常，该行后面的代码不会执行。

### 示例

```java
//以下程序编译报错
new FileInputStream("C:\\xxx.txt");
//原因：
//第一：这里调用了一个构造方法: FileInputStream(String name);
//第二：这个构造方法的声明位置上有：throw FileNotFoundException
//第三：通过类的继承结构可以看到：FileNotFoundException父类是IOException,IOException的父类是Exception，最终得知，FileNotFoundException是编译时异常。
//或者可以这么理解：编译时异常要求程序员编写程序阶段必须对它进行处理，不处理编译器就报错。
```

## 捕捉和上报，怎么选？

如果希望调用者来处理，选择throws上报

其他情况使用捕捉的方式。

## 常用方法

getMessage()用于获取异常简单描述信息

printStackTrace用于打印异常堆栈追踪信息（采用异步方式）

### 如何快速调试程序？

使用printStackTrace异常信息追踪信息，从上往下看。只需要看自己写得代码就好，根据包名查找。

## finally

在`finally`子句中的代码时最后执行的，并且是一定会执行的，即使`try`语句中的代码出现了异常。`finally`子句必须和`try`一起出现，不能单独编写。

通常`finally`语句用于完成资源的释放和关闭

## 自定义异常

两步：

- 第一步：编写一个类继承Exception或者RuntimeException。
- 第二步：提供两个构造方法，一个无参数的，一个带有String参数的。

注意：

- 手动抛出异常用`throw`，而在方法声明上抛出异常是使用`throws`
- 重写方法时，抛出的异常不能比原方法的多，只能少不能多。