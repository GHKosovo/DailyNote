在看frp时，看到它有一个Forward DNS query request的功能，看不懂，就翻了翻网上的资料，大概知道它是想干嘛了，但是既然谈到<span class="ljspan ljspan-red">转发DNS</span>，就干脆把DNS解析和转发等这些东西顺便写写:writing_hand:咯

<!--more-->	

## DNS域名解析

### namespace为互联网上的服务

linux上有个文件，`/etc/resolv.conf`是用来只想互联网上的DNS服务器的。一般内容如下：

```sh
# Generated by NetworkManager
nameserver 8.8.8.8
nameserver 222.222.222.222
```

这里就是域名解析啦，一般计算机使用域名上网时，会先找该本机的DNS服务器。如果本地DNS能找到域名，本地DNS直接回复客户机。如果本地DNS服务器不知道你请求的域名，他就转发DNS请求到互联网上，查找域名，就是通过8.8.8.8或者222.222.222.222，然后将查询到的域名解析后，最终将域名解析结果返回给客户机

### namespace为127.0.0.53

之前在一篇<span class="ljspan ljspan-reverse ljspan-green">[resolv.conf]()</span>有谈到有点这个东西，但是我没有解释，这里顺道解释咯，如果nameserver配置为127.0.0.53，那么它将不解析你的主机名。也就是不从本地主机上读取DNS服务

### namespace为主机IP

那能否把自己主机IP当作当作DNS服务器吗？而不用Internet上的DNS服务，当然可以啦:happy:

DNS服务安装完毕后，他就有根提示，天生就知道互联网上13个根DNS服务器。只要安装DNS服务的那台机器可以访问Internet，就完全可以解析全球域名。

因此DNS服务器的/etc/resolv.conf完全可以指向自己，对于未知域名，DNS服务器上的DNS服务会自己找根DNS服务器进行域名解析，并把解析结果保存在本地DNS服务器上。

<hr>

## 域名解析转发

考虑如下场景，母公司内部配置有本地DNS服务器，负责解析母公司内部服务器域名以及互联网上的域名。子公司与母公司物理距离较远，两地使用专线链接，专线带宽不高。子公司内部计算机不直接连接互联网。

假如不在子公司内部设置DNS服务器，子公司内部计算机对母公司内部域名解析请求以及互联网上域名解析请求都会交由母公司的DNS服务器（为啥子公司电脑不直接填互联网上的DNS？1.解析不到母公司私网的服务器 2.公司也不可能允许你这么做）。这部分域名解析流量会严重占用专用链路的带宽，导致网络阻塞。

在子公司内部设置一个DNS服务器，但是这个DNS服务器又有点不同。对于自己不知道域名，他并没有请求互联网上的根DNS服务器，而是把域名解析的流量转发给了母公司DNS服务器，这样有效降低了专用链路上域名解析的带宽占用。这种场景就是DNS转发。

DNS转发还有2种场景（或者说2个参数）

**①**foward only：子公司DNS服务器指向母公司DNS服务器请求DNS解析。如果母公司DNS服务器挂了 或 子公司到母公司链路故障 或 母公司DNS上不了网（子公司DNS服务器可以解析母公司内网服务器域名），子公司DNS服务器无法解析Internet域名

**②**foward first：子公司DNS服务器优先指向母公司DNS服务器，如果母公司DNS服务器连不上（比如子公司到母公司的链路故障）会使用子DNS服务器保存的根DNS服务器来解析域名（这时候无法解析母公司内网域名，可以解析Internet域名）。

如果子公司到母公司之间链路是好的，单纯母公司DNS服务器上不了网。子公司可以解析母公司内网服务器域名，但是无法解析Internet域名。

> 此段域名解析转发摘抄自这个[kelamoyujuzhen](https://www.cnblogs.com/kelamoyujuzhen/)的[文章](https://www.cnblogs.com/kelamoyujuzhen/p/9526915.html)